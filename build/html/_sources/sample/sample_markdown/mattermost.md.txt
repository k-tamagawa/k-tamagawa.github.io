# Mattermost プレビュー版

<div style="background-color: Lightskyblue; padding: 5px"><font color="white"><b>注釈</b></font></div>
<div style="background-color: LightCyan; padding: 5px">
画面右上の <a href="../../_sources/sample/sample_markdown/mattermost.md.txt">View page source</a> をクリックするとマークダウンを確認できます。<br>文字化けする場合はChromeだと拡張機能でCharsetを追加してください。
</div>

---

- 目次
    ```md
    <!-- Sphinxではこの表記は機能しない（内部リンク） -->
    - [プレビュー版のインストール](#プレビュー版のインストール)
    - [プレビュー版のhttps手順](#プレビュー版のhttps手順)
    - [mattermostのチーム削除](#mattermostのチーム削除)
    - [mysqlコマンド](#mysqlコマンド)
    ```
  
    - [プレビュー版のインストール](#プレビュー版のインストール)
    - [プレビュー版のhttps手順](#プレビュー版のhttps手順)
    - [mattermostのチーム削除](#mattermostのチーム削除)
    - [mysqlコマンド](#mysqlコマンド)

---

**インストール**

1. docker で以下を実行
    ```bat
    docker run --name mattermost-preview -d --publish 8065:8065 --add-host dockerhost:127.0.0.1 mattermost/mattermost-preview
    ```

1. インストール後のアクセス 
    ```md
    <!-- Sphinxではアドレスのみ記載は機能しない -->
    http://localhost:8065/
    ```

    http://localhost:8065/

**https手順**

1. docker内部へアクセス
    ```bat
    rem ホスト側で実行
    docker exec -it mattermost-preview bash
    ```

1. 証明書の保存場所を作成
    ```bash
    # docker内で実行
    cd /mm/mattermost/
    mkdir /mm/mattermost/tr00013271
    ```

1. 証明書とキーをコンテナにコピー
    ```bat
    rem ホスト側で実行
    rem 証明書とキーをコンテナにコピー
    docker cp cert.pem mattermost-preview:/mm/mattermost/tr00013271/cert.pem
    docker cp key.pem mattermost-preview:/mm/mattermost/tr00013271/key.pem
    ```

1. システムコンソールの設定(入力・修正した箇所のみ記載)  

    |項目|設定値|
    |---|---|
    |サイトURL|http://localhost:8065  |
    |接続のセキュリティ| TLS  |
    |TLS証明書ファイル| /mm/mattermost/tr00013271/cert.pem  |
    |TLS鍵ファイル| /mm/mattermost/tr00013271/key.pem  |
    |安全でない外向きの接続を有効にする| 有効にする|

**mattermostのチーム削除**

1. docker内部へアクセス
    ```bat
    rem ホスト側で実行
    docker exec -it mattermost-preview bash
    ```

1. mattermostコマンドを実行
    ```bash
    # コンテナ内で実行
    # GUIからのチーム削除はできない
    # dockerプレビュー版のconfigは、config.jsonではないので注意
    /mm/mattermost/bin/mattermost --config='/mm/mattermost/config/docker_config.json' team delete teamName
    ```

**mysqlコマンド**
1. docker内部へアクセス
    ```bat
    rem ホスト側で実行
    docker exec -it mattermost-preview bash
    ```
1. mysqlコマンドを実行
    ```bash
    # ログイン
    mysql -u mmuser -pmostest

    # 文字セット
    charset utf8;

    # DB選択
    use mattermost_test

    # テーブル一覧の表示
    show tables;

    # テーブル列名の取得
    describe Teams;

    # 検索
    select DisplayName, Name from Teams;
    ```

