# Windows Subsystem for Linux 2（WSL2）の有効化

「Linux 用 Windows サブシステム」を有効にする

```powershell
#Windows の機能の有効化または無効化 の画面でチェックをいれるのと同じコマンド
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
```

「仮想マシン プラットフォーム」を有効にする

```powershell
#Windows の機能の有効化または無効化 の画面でチェックをいれるのと同じコマンド
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

OSの再起動

WSL2 にアップデートする

```text
インストーラ
wsl_update_x64.msi

ダウンロードサイト
https://docs.microsoft.com/ja-jp/windows/wsl/install-manual#step-4---download-the-linux-kernel-update-package
```

WSL2の起動確認を行う

```powershell
wsl --set-default-version 2
# > WSL 2 との主な違いについては、https://aka.ms/wsl2 を参照してください
# > この操作を正しく終了しました。
```

1ubuntu 20.04 をインストール完了後、そのまま起動する

```text
インストーラー
Ubuntu_2004.2020.424.0_x64.appx

ダウンロードサイト
https://docs.microsoft.com/ja-jp/windows/wsl/install-manual
```

Ubuntuコンソールでエラーが表示された場合

```bash
# エラー内容　パターン１
Installing, this may take a few minutes...
WslRegisterDistribution failed with error: 0x8000000d
Error: 0x8000000d ????????????????

# エラー内容　パターン２
実行しようとした操作は、参照したオブジェクトの種類ではサポートされていません。
Press any key to continue...
```

```bat
rem 上記エラー時はNoLsp.exeをダウンロードしコマンドプロンプトで以下を実行する。
NoLsp.exe c:\windows\system32\wsl.exe
> Success!

rem ダウンロードサイト（GitHubのコメント欄にリンクあり）
rem http://www.proxifier.com/tmp/Test20200228/NoLsp.exe
```

ubuntu 20.04 を起動し、ユーザーとパスワードを設定後、コンソールを閉じる

```bash
# 設定せずに画面を閉じたらrootがデフォルトとなった
username: ubuntu
password: passw0rd
```

インストールしたubuntuをWSL2のデフォルトにする

```powershell
wsl --set-version Ubuntu-20.04 2
# > 変換中です。この処理には数分かかることがあります...
# > WSL 2 との主な違いについては、https://aka.ms/wsl2 を参照してください
# > ディストリビューションは既に、要求されているバージョンです。

>
```

ubuntuがwsl2で起動していることを確認する

```powershell
wsl -l -v
> NAME            STATE           VERSION
> * Ubuntu-20.04    Stopped         2

# StoppedとなっていたらスタートメニューからUbuntuを起動してください。
# 起動後はコンソールを閉じてもかまいません。
```

ubuntuのコマンド確認

```bash
# コマンドプロンプトで以下を実行すると、linuxのコンソールにかわります
wsl

#なんでもいいのでコマンド実行
ls
```

